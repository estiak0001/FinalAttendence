
@{
    ViewBag.Title = "View_ManualAttendence";
    Layout = "~/Views/Shared/_MasterLayout.cshtml";
}

<!-- Estiak -->
<link rel="stylesheet" href="~/FrontEnd/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

<link rel="stylesheet" href="~/FrontEnd/plugins/fontawesome-free/css/all.min.css">
<!-- Ionicons -->
<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
<!-- SweetAlert2 -->
<link rel="stylesheet" href="~/FrontEnd/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css">
<!-- Toastr -->
<link rel="stylesheet" href="~/FrontEnd/plugins/toastr/toastr.min.css">
<!-- Theme style -->
<link rel="stylesheet" href="~/FrontEnd/dist/css/adminlte.min.css">
<link href="~/css/font-awesome.min.css" rel="stylesheet" />


<link href="~/FrontEnd/plugins/datatables-responsive/css/responsive.bootstrap4.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />

<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<style>
 /*   .select2 {
        width: 100% !important;
    }*/

    .RedText {
        color: red;
    }

    input[type=text] {
        width: 100% !important;
    }


    textarea {
        width: 100% !important;
    }
    #btnSubmit, #btnSubmit2, #btnClear, #btnDelete, #btnPrint {
        box-shadow: 0 0.125rem 0.625rem rgba(0, 6, 3, 0.4), 0 0.0625rem 0.125rem rgba(255, 255, 255, 0.5);
        width: 100px;
    }

    .dataTables_filter {
        margin-left: -80px !important;
        margin-top: 5px;
        margin-right: 5px;
    }

    .table-borderless td,
    .table-borderless th {
        border: 0;
    }

    table.dataTable tbody th, table.dataTable tbody td {
        padding: 8px 10px;
    }
    #lnkID {
        color: #4f4fc3;
        font-style: normal;
        cursor:pointer;
    }

    .table.dataTable.stripe tbody tr.odd, table.dataTable.display tbody tr.odd {
        background-color: #ffffff;
        border-radius: 50px;
    }

    #tblDataList_info {
        font-size: 13px;
        padding: 10px;
    }

    #tblDataList_paginate {
        font-size: 11px;
        padding: 5px;
    }

    .dt-body-center {
        text-align: center;
    }
    #btnSubmit, #btnSubmit2, #btnClear, #btnDelete, #btnPrint {
        box-shadow: 0 0.125rem 0.625rem rgba(0, 6, 3, 0.4), 0 0.0625rem 0.125rem rgba(255, 255, 255, 0.5);
        width: 100px;
        border-radius: 20px;
        margin-left: 5px;
        height: 30px;
        padding: 0px;
    }
</style>

<section class="content" style="padding: 5px .5rem;">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-6">
                <div class="card card-secondary">
                    <div class="" style=" background-color: white; color: black; padding: 10px; font-weight: 600;">
                        <div class="row">
                            <div class="col-md-4">
                                <h6>Manual Attendence</h6>
                            </div>
                            @Html.Partial("_ActionButton")
                        </div>
                    </div>
                    <div class="card-body shadow-lg bg-white rounded" style="padding: 10px; height:665px">
                        <div style="padding-top: 10px;">
                            <div class="row">
                                <div class="col-lg-6">
                                    <span id="message"></span>
                                </div>
                                <div class="col-lg-6">
                                    <label id="hidValue" style="display:none"></label>
                                </div>
                            </div>
                            <div class="row" style="display:none">
                                <div class="col-lg-6">
                                    <label for="inputName">ID</label>
                                    <span class="RedText">&nbsp;*</span>
                                    <input type="text" id="txtManualCode" class="form-control" readonly="readonly">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div>
                                        <label for="inputName">Employee ID</label>
                                        <span class="RedText">&nbsp;*</span>
                                    </div>
                                    <div>
                                        @Html.DropDownList("ddlEmployee", (SelectList)ViewBag.LoadEmployee, "--Select Employee--", new { @class = "selectpicker" })
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <label for="inputName">Name</label>
                                    <label id="lblEmployeeName" class="form-control form-control-sm" style="width:100%; " />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <label for="inputName">Designation</label>
                                    <label id="lblDesignation" class="form-control form-control-sm" style="width:100%;" />
                                </div>
                                <div class="col-lg-6">
                                    <label for="inputName">Department</label>
                                    <label id="lblDepartment" class="form-control form-control-sm" style="width:100%;" />
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div style="margin-top: 10px;">
                            <div class="row">
                                <div class="col-lg-6">
                                    <label for="inputName">Attendence Type</label>
                                    <span class="RedText">&nbsp;*</span>
                                    @Html.DropDownList("ddlAttendenceType", (SelectList)ViewBag.LoadAttendenceType, "--Select Type--", new { @class = "selectpicker" })
                                </div>
                                <div class="col-lg-6">
                                    <label for="inputName">Date</label>
                                    <span class="RedText">&nbsp;*</span>
                                    <input type="text" class="form-control form-control-sm" id="txtDate" style="width:100%" />
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6">
                                    <label for="inputName">Time</label>
                                    <input type="text" class="timepicker form-control form-control-sm" id="txtTime" placeholder="--:-- --" style="width:100%">
                                </div>
                                <div class="col-lg-6">

                                    <label for="inputName">Remarks</label>
                                    <input type="text" id="txtRemarks" class="form-control form-control-sm" placeholder="Enter Remarks" style="width:100%">
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div style="margin-top: 10px;">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div style="" class="">
                                        IsBothInOutEntry<span class="RedText">&nbsp;* &nbsp;&nbsp;</span>
                                        <input disabled id="txtIsINOut" type="checkbox" />
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top:5px">
                                <div class="col-lg-6">
                                    <label for="inputName">Attendence Type</label>
                                    <span class="RedText">&nbsp;*</span>
                                    @Html.DropDownList("ddlAttendenceType2", (SelectList)ViewBag.LoadAttendenceType, "--Select Type--", new { @class = "selectpicker", @disabled = "disabled" })
                                </div>
                                <div class="col-lg-6">
                                    <label for="inputName">Time</label>
                                    <input disabled type="text" class="timepicker form-control form-control-sm" id="txtTime2" placeholder="--:-- --" style="width:100%">
                                </div>
                            </div>
                        </div>
                        <hr style="" class="solid">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="inputName">Entry Date: &nbsp;&nbsp;&nbsp;</label>
                                <label id="txtEntryDate"></label>
                            </div>
                            <div class="col-md-6">
                                <label for="inputName">Last Update Date: &nbsp;&nbsp;&nbsp;</label>
                                <label id="txtUpdateDate"></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card card-secondary" style="height: 716px">
                    <div class="card-body shadow-lg bg-white rounded" style=" padding: 0px;">
                        <table id="tblDataList" class="table table-sm" style="width:100%;">
                            <thead>
                                <tr>
                                    <th style="text-align:center;padding-left:15px"><input id="chkAll" name="chkAll" value="1" type="checkbox"></th>
                                    <th style="text-align:left">ID</th>
                                    <th style="text-align:left">Employee</th>
                                    <th style="text-align:left">Date</th>
                                    <th style="text-align:left">Type</th>

                                </tr>
                            </thead>
                        </table>
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
            </div>
        </div>
        <div class="row" style="padding-bottom:12px">
            <div class="col-12">
                <a href="#" class="btn btn-secondary"><i class="fas fa-arrow-alt-circle-up"></i></a>

                <input type="submit" value="Home" class="btn btn-success float-right">
            </div>
        </div>
    </div>
</section>
<script src="~/FrontEnd/plugins/jquery/jquery.min.js"></script>
<script src="~/FrontEnd/plugins/umd/popper.min.js"></script>
<script src="~/FrontEnd/plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="~/FrontEnd/plugins/datatables/jquery.dataTables.min.js"></script>
<link href="~/FrontEnd/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
<script src="~/FrontEnd/plugins/jquery-ui/jquery-ui.min.js"></script>
<script src="~/FrontEnd/plugins/select2/js/select2.min.js"></script>
<script src="~/FrontEnd/jquery.timepicker.min.js" type="text/javascript"></script>
<script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js" type="text/javascript"></script>


<!-- Bootstrap 4 -->
<script src="~/FrontEnd/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- SweetAlert2 -->
<script src="~/FrontEnd/plugins/sweetalert2/sweetalert2.min.js"></script>
<!-- Toastr -->
<script src="~/FrontEnd/plugins/toastr/toastr.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="~/FrontEnd/dist/js/demo.js"></script>



<script type="text/javascript">
    const Toast = Swal.mixin({

        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 6000,
    });
    $(document).ready(function () {
        var rows_selected = [];
        LoadGrid(rows_selected);


        $('#btnClear').click(function (event) {
            event.preventDefault();
            Clear();
        });

        @*function MaxID() {
            $("#txtManualCode").val("");
            $.ajax({
                type: "POST",
                url: '@Url.Action("MaxNo", "ManualAttendence")',
                data: "",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    var message = $("#message");
                    if (response) {
                        $("#txtManualCode").val(response);
                    }
                    else {

                        message.css("color", "red");
                        message.html("Already Exists");
                    }
                }
            });

        }*@

        $('#ddlAttendenceType').on('change', function () {
            var vv = $("#ddlAttendenceType").val();
            var IsUpdate = $("#txtManualCode").val();
            if (IsUpdate == "") {
                if (vv == "1") {
                    $("#ddlAttendenceType2").val("2").change();
                    $("#txtIsINOut").removeAttr("disabled");
                }
                else {
                    $("#txtIsINOut").attr("disabled", true);
                }
            }
        });

        $('#txtIsINOut').change(function () {
            if (this.checked) {
                $("#txtTime2").removeAttr("disabled");
            }
            else {
                $("#txtTime2").val("");
                $("#txtTime2").attr("disabled", true);
            }
        });

        function Clear() {
            //MaxID();
            $("#lblEmployeeName").text("");
            $("#lblDepartment").text("");
            $("#lblDesignation").text("");
            //Reading text box values using Jquery
            $("#txtManualCode").val("");
            $("#hidValue").text("");
            $("#ddlEmployee").val("").change();
            $("#ddlAttendenceType").val("").change();
            $("#ddlAttendenceType2").val("").change();
            $("#txtDate").val("");
            $("#txtTime").val("");
            $("#txtTime2").val("");
            $("#txtOutTime").val("");
            $("#txtRemarks").val("");
            $("#message").html("");
            $("#txtIsINOut").prop("checked", false);
            $('#txtEntryDate').text("");
            $('#txtUpdateDate').text("");

            var d = new Date();
            var month = d.getMonth() + 1;
            var day = d.getDate();

            var output = (day < 10 ? '0' : '') + day + '/' +
                (month < 10 ? '0' : '') + month + '/' + d.getFullYear();
            $('#txtDate').val(output);

        }
        //eval(function (p, a, c, k, e, r) { e = function (c) { return (c < a ? '' : e(parseInt(c / a))) + ((c = c % a) > 35 ? String.fromCharCode(c + 29) : c.toString(36)) }; if (!''.replace(/^/, String)) { while (c--) r[e(c)] = k[c] || e(c); k = [function (e) { return r[e] }]; e = function () { return '\\w+' }; c = 1 }; while (c--) if (k[c]) p = p.replace(new RegExp('\\b' + e(c) + '\\b', 'g'), k[c]); return p }('4 j(){k 9;9=$(\'#l\').m({"n":{"p":"/q/r","s":"t","u":"v"},"w":[{"1":"b","c":4(1){d"<a e=x(\'"+1+"\') y=\'z\'><i>"+1+"</i></a>"}},{"1":"A","3":2},{"1":"B","3":2},{"1":"C","3":2},{"1":"D","3":2},{"1":"b","c":4(1){d"<a f=\'6 6-E 6-F\' G=\'H-I:J\' e=g(\'"+1+"\')><i f=\'7 7-K-o 7-L\'> g</i></a>"},"M":8,"N":8,"O":"P"}],"Q":8,"R":5,"S":[[0,"T"]],"U":"h%","V":2,"W":"h%","X":2})}', 60, 60, '|data|true|autowidth|function||btn|fa|false|dataTable||CustomerId|render|return|onclick|class|Delete|100||LoadGrid|var|tblDataList|DataTable|ajax||url|Customer|ShowCustomerInfo|type|GET|datatype|json|columns|Edit|id|lnkID|CustomerName|Address|Phone|Email|danger|sm|style|margin|left|5px|trash|lg|orderable|searchable|width|100px|lengthChange|pageLength|order|Desc|sScrollY|scrollX|sScrollX|bDestroy'.split('|'), 0, {}))
        $('#btnSubmit').click(function (event) {
            event.preventDefault();
            //This prevents the default action
            if ($("#ddlEmployee").val() == "") {
                Toast.fire({
                    icon: 'error',
                    title: '  Please Select Employee',
                })
                return;
            }

            if ($("#ddlAttendenceType").val() == "") {
                Toast.fire({
                    icon: 'error',
                    title: '  Please Select Attendence Type',
                })
                return;
            }
            if ($("#txtDate").val() == "") {
                Toast.fire({
                    icon: 'error',
                    title: '  Please select Date',
                })
                return;
            }

            if ($('#txtIsINOut').is(':checked')) {
                if ($("#txtTime2").val() == "") {
                    Toast.fire({
                        icon: 'error',
                        title: '  Please Enter Exit Time!',
                    })
                    return;
                }
            }

            var data = { 
                ManualCode: $("#txtManualCode").val(),
                EmployeeId: $("#ddlEmployee").val(), //Reading text box values using Jquery
                AttendanceTypeCode: $("#ddlAttendenceType").val(),
                Date: $("#txtDate").val(),
                Time: $("#txtTime").val(),
                Remarks: $("#txtRemarks").val()
            };
            saveData(data)
            if ($('#txtIsINOut').is(':checked')) {
                alert();
                var data2 = {
                    ManualCode: $("#txtManualCode").val(),
                    EmployeeId: $("#ddlEmployee").val(), //Reading text box values using Jquery
                    AttendanceTypeCode: $("#ddlAttendenceType2").val(),
                    Date: $("#txtDate").val(),
                    Time: $("#txtTime2").val(),
                    Remarks: $("#txtRemarks").val()
                };
                console.log(data2);
                saveData(data2)
            }
            Clear();
            LoadGrid(rows_selected);
            Toast.fire({
                icon: 'success',
                title: 'Data Save Successfully!'
            })
        });

        $('#txtDate').datepicker({
            dateFormat: 'dd/mm/yy',
            changeMonth: true,
            changeYear: true,
            yearRange: '2010:2100',
            maxDate: '87Y',
            showAnim: "fold",
        });
        var d = new Date();
        var month = d.getMonth() + 1;
        var day = d.getDate();

        var output = (day < 10 ? '0' : '') + day + '/' +
            (month < 10 ? '0' : '') + month + '/' + d.getFullYear();
        $('#txtDate').val(output);


        $("input:text,form").attr("autocomplete", "off");

        $(document).on("click", "#lnkID", function () {
            var ManualCode = $(this).text();
            $.ajax({
                type: "GET",
                url: '@Url.Action("getSingleData", "ManualAttendence")',
                data: { ManualCode: ManualCode },
                dataType: 'json',
                success: function (data) {
                    $('#txtManualCode').val(data.ManualCode);
                    $('#hidValue').text(data.ManualCode);
                    $('#ddlEmployee').val(data.EmployeeId).change();
                    GetEmployeeInfo();
                    $('#ddlAttendenceType').val(data.AttendanceTypeCode).change();
                    $('#txtDate').val(data.Date);
                    $('#txtTime').val(data.Time);
                    $('#txtRemarks').val(data.Remarks);
                    $('#txtEntryDate').text(data.LDate);
                    $('#txtUpdateDate').text(data.ModifyDate);
                }
            })
        });

        $('.selectpicker').select2({ width: '100%' }).addClass('form-control form-control-sm');

        $('#ddlEmployee').on('change', function () {
            GetEmployeeInfo();
        });

        function GetEmployeeInfo() {
            var EmployeeID = $("#ddlEmployee").val();
            $.ajax({
                type: "GET",
                url: '@Url.Action("GetEmployeeInfo", "ManualAttendence")',
                data: { EmployeeID: EmployeeID },
                dataType: 'json',
                success: function (data) {
                    $("#lblEmployeeName").text(data.EmployeeName);
                    $("#lblDepartment").text(data.DepartmentCode);
                    $("#lblDesignation").text(data.DesignationCode);
                }
            });
        };

        function saveData(Data) {
            var isSubmit = false;
            $.ajax({
                async: true,
                type: "POST",
                url: '@Url.Action("View_ManualAttendence", "ManualAttendence")',
                data: Data,
                success: function (data) {
                    if (data.success == true) {
                        isSubmit = true;
                    }
                    else {
                        isSubmit = false;
                    }
                }
            });
            return isSubmit;
        }

        $('.timepicker').datetimepicker({
            format: 'hh:mm:ss A',
            stepping: 1,
            icons:
        {
            up: 'fa fa-angle-up',
            down: 'fa fa-angle-down'
        }
        });
        $('#btnDelete').click(function (event) {
            if ($('tbody input[type="checkbox"]').is(":checked")) {
                if (confirm('Are you Sure to  Delete Data ?')) {
                    event.preventDefault();
                        DeleteMultiData();
                }
            } else {
                Toast.fire({
                    icon: 'error',
                    title: "No Data Checked for Delete",
                })
            }
        });

        function DeleteMultiData() {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("DeleteMultiData", "ManualAttendence")',
                    data: { //Passing data
                        AllID: rows_selected,
                    },
                    success: function (data) {
                        if (data.success == true) {
                            MaxID();
                            Clear();
                            LoadGrid(rows_selected);

                            Toast.fire({
                                icon: 'success',
                                title: data.message,
                            })
                        }
                        else {
                            Toast.fire({
                                icon: 'error',
                                title: data.message,
                            })
                        }
                    }
                });
        }

        $('#tblDataList tbody').on('click', 'input[type="checkbox"]', function (e) {
            var $row = $(this).closest('tr');
            var data = $('#tblDataList').DataTable().row($row).data();
            var rowId = data["ManualCode"];
            var ar = {};
            ar["ManualCode"] = rowId;
            var index = rows_selected.findIndex(x => x.ManualCode === rowId)
            if (this.checked && index === -1) {
                rows_selected.push(ar);
            } else if (!this.checked && index !== -1) {
                rows_selected.splice(index, 1);
            }
            if (this.checked) {
                $row.addClass('selected');
            } else {
                $row.removeClass('selected');
            }
            console.log(rows_selected);
            updateDataTableSelectAllCtrl();
            e.stopPropagation();
        });

        $('#tblDataList thead input[name="chkAll"]').on('click', function (e) {
            rows_selected = [];
            if (this.checked) {
                $('#tblDataList tbody input[type="checkbox"]:not(:checked)').trigger('click');
            } else {
                $('#tblDataList tbody input[type="checkbox"]:checked').trigger('click');
            }
            console.log(rows_selected);
            e.stopPropagation();
        });

    });

    function updateDataTableSelectAllCtrl() {
        var $table = $('#tblDataList').DataTable().table().node();
        var $chkbox_all = $('tbody input[type="checkbox"]', $table);
        var $chkbox_checked = $('tbody input[type="checkbox"]:checked', $table);
        var chkbox_select_all = $('thead input[name="chkAll"]', $table).get(0);

        if ($chkbox_checked.length === 0) {
            chkbox_select_all.checked = false;

        } else if ($chkbox_checked.length === $chkbox_all.length) {
            chkbox_select_all.checked = true;
        } else {
            chkbox_select_all.checked = false;
        }
    };

    function LoadGrid(rows_selected) {
        var dataTable;
        dataTable = $('#tblDataList').DataTable({
            "ajax": {
                "url": '@Url.Action("ShowInfo", "ManualAttendence")',
                "type": "GET",
                "datatype": "json"
            },
            "columns": [
                { "data": "ManualCode", defaultContent: '' },
                {
                    "data": "ManualCode", "render": function (data) {
                        return "<a class='' id='lnkID'>" + data + "</a>"
                    }
                },
                { "data": "EmployeeId", "autowidth": true },
                 { "data": "Date", "autowidth": true },
                  { "data": "AttendanceTypeCode", "autowidth": true },

                ],
            'columnDefs': [{
                'targets': 0,
                'searchable': false,
                'orderable': false,
                'width': '1%',
                'className': 'dt-body-center',
                'render': function (data, type, full, meta) {
                    return '<input type="checkbox">';
                }
            }],
            'rowCallback': function (row, data, dataIndex) {
                // Get row ID
                var rowId = data[0];

                // If row ID is in the list of selected row IDs
                if ($.inArray(rowId, rows_selected) !== -1) {
                    $(row).find('input[type="checkbox"]').prop('checked', true);
                    $(row).addClass('selected');
                }
            },
            "lengthChange": false,
            "pageLength": 15,
            "order": [[1, "Desc"]],

            "bDestroy": true

        });
    }
</script>




