
@{
    ViewBag.Title = "View_RosterScheduleEntry";
    Layout = "~/Views/Shared/_MasterLayout.cshtml";
}

<!-- Estiak -->
<link rel="stylesheet" href="~/FrontEnd/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

<link rel="stylesheet" href="~/FrontEnd/plugins/fontawesome-free/css/all.min.css">
<!-- Ionicons -->
<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
<!-- SweetAlert2 -->
<link rel="stylesheet" href="~/FrontEnd/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css">
<!-- Toastr -->
<link rel="stylesheet" href="~/FrontEnd/plugins/toastr/toastr.min.css">
<!-- Theme style -->
<link rel="stylesheet" href="~/FrontEnd/dist/css/adminlte.min.css">
<link href="~/FrontEnd/plugins/datatables-responsive/css/responsive.bootstrap4.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />

<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<style>
    .select2 {
        width: 100% !important;
    }

    .RedText {
        color: red;
    }

    input[type=text] {
        width: 100% !important;
    }


    textarea {
        width: 100% !important;
    }

    .dataTables_filter {
        margin-left: -80px !important;
    }

    .linkbutton1 {
        border: 1px solid #2c7cb0;
        font-size: 9px;
        padding: 5px;
        text-decoration: none;
        height: 50px;
        width: 60px;
        padding-top: 13px;
        background-color: #2c7cb0;
        color: #ffffff;
        font-weight: bold;
    }

    .select2-container--default.select2-container--focus .select2-selection--multiple, .select2-container--default.select2-container--focus .select2-selection--single {
        border-color: #80bdff;
        height: 37px !important;
        width: 100% !important;
    }

    .select2-container--default .select2-selection--single {
        background-color: #fff;
        border: 1px solid #ced4da;
        border-radius: 4px;
        height: 37px !important;
        width: 100% !important;
    }


    #btnSubmit, #btnSubmit2, #btnClear, #btnDelete, #btnPrint {
        box-shadow: 0 0.125rem 0.625rem rgba(0, 6, 3, 0.4), 0 0.0625rem 0.125rem rgba(255, 255, 255, 0.5);
        width: 100px;
    }

    .table-striped tbody tr:nth-of-type(odd) {
        background-color: rgba(0,0,0,0);
    }
    #ddlCompany2
    {
        margin-right:5px;
    }
    .inputName{
        padding-top:10px;
    }
</style>

<section class="content-header" style="padding:0px">
    <div class="container-fluid">
        <div class="callout callout-info" style="padding-top: 10px;">
            <div class="row mb-2" style="height: 19px;">
                <div class="col-md-12 row">
                    <ul class="breadcrumb float-sm-right" id="mymenu">
                        <li class="" style="margin-right: 5px; margin-left: 5px;"><a href='@Url.Action("View_Company", "Company")' class=" btn btn-sm btn-outline-secondary" style="text-decoration:none"> Company </a></li>
                        <li class="" style="margin-right: 5px;"><a href='@Url.Action("View_Department", "Department")' class=" btn btn-sm btn-outline-secondary" style="text-decoration:none"> Department </a></li>
                        <li class="" style="margin-right: 5px;"><a href='@Url.Action("View_Designation", "Designation")' class=" btn btn-sm btn-outline-secondary" style="text-decoration:none"> Designation </a></li>
                        <li class="" style="margin-right: 5px;"><a href='@Url.Action("AddOrEdit", "AttendenceType")' class=" btn btn-sm btn-outline-secondary" style="text-decoration:none"> Att. Type </a></li>
                        <li class="" style="margin-right: 5px;"><a href='@Url.Action("View_RosterScheduleEntry", "RosterScheduleEntry")' class=" btn btn-sm btn-outline-secondary active" style="text-decoration:none"> Roster</a></li>
                        <li class="" style="margin-right: 5px;"><a href='@Url.Action("Vw_Shift", "Shift")' class=" btn btn-sm btn-outline-secondary" style="text-decoration:none"> Shift </a></li>
                        <li class="" style="margin-right: 5px;"><a href='@Url.Action("View_CompanyWeekend", "CompanyWeekend")' class=" btn btn-sm btn-outline-secondary" style="text-decoration:none"> Weekend </a></li>
                        <li class="" style="margin-right: 5px;"><a href='@Url.Action("View_SpecialWeekend", "SpecialWeekend")' class=" btn btn-sm btn-outline-secondary" style="text-decoration:none">Special Weekend </a></li>
                        <li class="" style="margin-right: 5px;"><a href='@Url.Action("Vew_Holiday", "Holiday")' class=" btn btn-sm btn-outline-secondary" style="text-decoration:none"> Holiday </a></li>
                        <li class="" style="margin-right: 5px;"><a href='@Url.Action("Vew_LeaveType", "LeaveType")' class=" btn btn-sm btn-outline-secondary" style="text-decoration:none"> Leave Type </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div><!-- /.container-fluid -->
</section>



<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-5">
                <div style="padding:2px; height:756px" class="card card-primary ">                  
                    <div style="padding:10px" class="card-body">
                        <div class="row" style="">
                            <div class="col-md-6">
                                <label class="inputName">Company</label>
                                @Html.DropDownList("ddlCompany", (SelectList)ViewBag.LoadCompany, new { @class = "selectpicker form-control form-control-sm" })
                            </div>
                            <div class="col-md-6">
                                <label class="inputName">Branch</label>
                                @Html.DropDownList("ddlBranch", (SelectList)ViewBag.Branch, "--All--", new { @class = "selectpicker form-control form-control-sm" })
                            </div>
                        </div>
                        <div class="row" style="">
                            <div class="col-md-6">
                                <label class="inputName">Department</label>
                                @Html.DropDownList("ddlDepartment", (SelectList)ViewBag.LoadDepartment, "--All--", new { @class = "selectpicker form-control form-control-sm" })
                            </div>
                            <div class="col-md-6">
                                <label class="inputName">Designation</label>
                                @Html.DropDownList("ddlDesignation", (SelectList)ViewBag.LoadDesignation, "--All--", new { @class = "selectpicker form-control form-control-sm" })
                            </div>
                        </div>
                        <div style=" padding-top: 17px; border-top: 1px solid black; margin-top: 15px;">
                            <table id="tblRosterEmployee" class="table  table-sm responsive" style="width:100%">
                                <thead>
                                    <tr>
                                        <th><input id="chkAll" name="chkAll" value="1" type="checkbox"></th>
                                        <th style="text-align:left">Employee ID</th>
                                        <th style="text-align:left">Employee Name</th>
                                        <th style="text-align:center">Department</th>
                                        @*<th style="text-align:center">Designation</th>*@
                                    </tr>
                                </thead>
                            </table>
                        </div>
                        <div class="row">
                            <div class="col-lg-6">
                                <span id="message"></span>
                            </div>
                            <div class="col-lg-6">
                                <label id="hidValue" style="display:none"></label>
                            </div>
                        </div>

                        <div class="row no-print" style="margin-top: 9px; display:none;">
                            <div class="col-12">
                                <button type="button" style="border-radius:18px; font-size:12px; border: none; float:right " id="btnSubmit2" class=" btn-shadow btn-wide btn btn-success waves-effect waves-light">
                                    <span class="btn-icon-wrapper pr-2 opacity-7"><i class="fas fa-plus"></i></span>Save
                                </button>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-7">
                <div class="card card-secondary" style="">
                    <div class="" style=" background-color: white; color: black; padding: 10px; font-weight: 600;">
                        <div class="row">
                            <div class="col-md-4">
                                <h6>Roster</h6>
                            </div>
                            @Html.Partial("_ActionButton")
                        </div>
                    </div>
                    <div class="card-body shadow-lg bg-white rounded" style="padding: 10px;">
                        <div class="row" style="display:none">
                            <div class="col-lg-6">
                                <label class="inputName">ID</label>
                                <span class="RedText">&nbsp;*</span>
                                <input type="text" id="txtRosterScheduleId" class="form-control form-control-sm" readonly="readonly"
                                       value="@(ViewBag.MaxComID ?? String.Empty)">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6">
                                <label class="inputName">Date From</label>
                                <span class="RedText">&nbsp;*</span>
                                <input type="text" id="txtFromDate" class="form-control form-control-sm" placeholder="Date From" style="width:100%">
                            </div>
                            <div class="col-lg-6">
                                <label class="inputName">To</label>
                                <span class="RedText">&nbsp;*</span>
                                <input type="text" id="txtToDate" class="form-control form-control-sm" placeholder="Date To" style="width:100%">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-6">
                                <label class="inputName">Shift</label>
                                <span class="RedText">&nbsp;*</span>
                                @Html.DropDownList("ddlShift", (SelectList)ViewBag.LoadShift, "--Select Type--", new { @class = "selectpicker" })
                            </div>
                            <div class="col-lg-6">
                                <label class="inputName">Remarks</label>
                                <input type="text" id="txtRemnark" class="form-control form-control-sm" placeholder="Remarks" style="width:100%" />
                            </div>
                        </div>
                        <!-- /.card-body -->
                    </div>
                </div>
                <!-- /.card -->
                <div class="card" style="padding:0px;">
                    <div class="card-header">
                        <h6 style="border-right: 2px solid #aca8a3; margin-right: 20px; padding: 6px; margin: 0px; margin-right: 0px; padding-right: 7px; margin-right: 8px;" class="">Filter</h6>
                        <div style="width: 100%;" class="row">
                            <div class="col-md-3">
                                @Html.DropDownList("ddlCompany2", (SelectList)ViewBag.LoadCompany, new { @class = "selectpicker form-control form-control-sm", @style = "width:10%px; margin-right: 5px;" })
                            </div>
                            <div class="col-md-3">
                                @Html.DropDownList("ddlBranch2", (SelectList)ViewBag.Branch, "--Branch--", new { @class = "selectpicker", @style = "width:10%px; margin-right: 5px;" })
                            </div>
                            <div class="col-md-3">
                                @Html.DropDownList("ddlDepartment2", (SelectList)ViewBag.LoadDepartment, "--Department--", new { @class = "selectpicker", @style = "width:10%px; margin-right: 5px;" })
                            </div>
                            <div class="col-md-3">
                                @Html.DropDownList("ddlDesignation2", (SelectList)ViewBag.LoadDesignation, "--Designation--", new { @class = "selectpicker", @style = "width:10%px" })
                            </div>
                        </div>
                    </div>
                    <div class="card-body" style="padding:10px">
                        <table id="tblSaveRosterEmployee" class="table  table-sm" style="width:100%">
                            <thead>
                                <tr>
                                    <th style="text-align:left">Employee ID</th>
                                    <th style="text-align:left">Employee Name</th>
                                    <th style="text-align:center">Date</th>
                                    <th style="text-align:center">Shift</th>
                                    <th style="text-align:center">Remarks</th>
                                </tr>
                            </thead>
                        </table>
                        <div class="row">
                            <div class="col-lg-6">
                                <span id="message"></span>
                            </div>
                            <div class="col-lg-6">
                                <label id="hidValue" style="display:none"></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</section>

<script src="~/FrontEnd/plugins/jquery/jquery.min.js"></script>
<script src="~/FrontEnd/plugins/umd/popper.min.js"></script>
<script src="~/FrontEnd/plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="~/FrontEnd/plugins/datatables/jquery.dataTables.min.js"></script>
<link href="~/FrontEnd/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
<script src="~/FrontEnd/plugins/jquery-ui/jquery-ui.min.js"></script>
<script src="~/FrontEnd/plugins/select2/js/select2.min.js"></script>
<script src="~/FrontEnd/jquery.timepicker.min.js" type="text/javascript"></script>
<script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js" type="text/javascript"></script>


<!-- Bootstrap 4 -->
<script src="~/FrontEnd/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- SweetAlert2 -->
<script src="~/FrontEnd/plugins/sweetalert2/sweetalert2.min.js"></script>
<!-- Toastr -->
<script src="~/FrontEnd/plugins/toastr/toastr.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="~/FrontEnd/dist/js/demo.js"></script>
<script type="text/javascript">
    const Toast = Swal.mixin({

        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 6000,
    });
    $(document).ready(function () {
        var rows_selected = [];

        var CompanyCode = "";
        var DepartmentCode = "";
        var DesignationCode = "";
        var Branch = "";
        LoadRosterEmployee(CompanyCode, Branch, DepartmentCode,DesignationCode,rows_selected);
        LoadGrid("", "", "", "");


        $('#btnClear').click(function (event) {
            event.preventDefault();
            Clear();
        });

        function MaxID() {
            $("#txtRosterScheduleId").val("");
            $.ajax({
                type: "POST",
                url: '@Url.Action("MaxNo", "RosterScheduleEntry")',
                data: "",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    var message = $("#message");
                    if (response) {
                        $("#txtLeaveTypeId").val(response);
                    }
                    else {
                        message.css("color", "red");
                        message.html("Already Exists");
                    }
                }
            });
        }
        function Clear() {
            MaxID();
            $("#txtFromDate").val("");
            $("#txtToDate").val("");
            $("#ddlShift").val("").change();;
            $("#txtRemnark").val("");
            $("#ddlCompany").val("").change();
            $("#ddlDepartment").val("").change();
            $("#ddlDesignation").val("").change();

            $('#tblRosterEmployee thead input[name="chkAll"]').prop('checked', false);
            $('#tblRosterEmployee tbody input[type="checkbox"]').prop('checked', false);
        }
        $('#btnSubmit, #btnSubmit2').click(function (event) {
            event.preventDefault();
            //This prevents the default action
            if ($("#txtFromDate").val() == "") {
                Toast.fire({
                    icon: 'error',
                    title: '  Please Select From Date',
                })
                return;
            }
            if ($("#txtToDate").val() == "") {
                Toast.fire({
                    icon: 'error',
                    title: '  Please To Date',
                })
                return;
            }
            if ($("#ddlShift").val() == "") {
                Toast.fire({
                    icon: 'error',
                    title: '  Please select Shift',
                })
                return;
            }

            //if ($("#txtRemnark").val() == "") {
            //    Toast.fire({
            //        icon: 'error',
            //        title: '  Please give Remnark',
            //    })
            //    return;
            //}

            $.ajax({
                async: true,
                type: "POST",
                url: '@Url.Action("View_RosterScheduleEntry", "RosterScheduleEntry")',
                data: { //Passing data
                    RosterScheduleId: $("#txtRosterScheduleId").val(),
                    RsemployeeID: rows_selected,
                    FromDate: $("#txtFromDate").val(),
                    ToDate: $("#txtToDate").val(),
                    ShiftCode: $("#ddlShift").val(),
                    Remark: $("#txtRemnark").val()
                },
                success: function (data) {
                    if (data.success == true) {
                        Clear();
                        LoadGrid("","","","");
                        Toast.fire({
                            icon: 'success',
                            title: 'Data Save Successfully!'
                        })
                    }
                    else {

                        Toast.fire({
                            icon: 'error',
                            title: data.message,
                        })
                    }
                }

            });

        });

        $('#btnDelete').click(function (event) {
            event.preventDefault();
            Delete();
        });

        // Start SelectPicker//

        $('#txtFromDate').datepicker({
            dateFormat: 'dd/mm/yy',
            changeMonth: true,
            changeYear: true,
            yearRange: '2010:2100',
            maxDate: '87Y'

        });

        $('#txtToDate').datepicker({
            dateFormat: 'dd/mm/yy',
            changeMonth: true,
            changeYear: true,
            yearRange: '2010:2100',
            maxDate: '87Y'
        });



        $("input:text,form").attr("autocomplete", "off");

        function Delete() {
            if (confirm('Are you Sure to  Delete Data ?')) {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("Delete", "RosterScheduleEntry")',
                    data: { //Passing data
                        RsemployeeID: rows_selected,
                        FromDate: $("#txtFromDate").val(),
                        ToDate: $("#txtToDate").val()
                    },
                    success: function (data) {

                        if (data.success == true) {

                            Clear();
                            LoadGrid("","","","");
                            Toast.fire({
                                icon: 'success',
                                title: data.message,
                            })
                        }
                        else {
                        }
                    }
                });
            }
        }

        $('.selectpicker').select2();


        //$('#ddlCompany').on('change', function () {

        //    var DepartmentCode = "";
        //    var CompanyCode = $("#ddlCompany").val();
        //    var DesignationCode = "";
        //    LoadRosterEmployee(CompanyCode, DepartmentCode, DesignationCode, rows_selected);
        //});

        //$('#ddlDepartment').on('change', function () {
        //    var CompanyCode = "";
        //    var DepartmentCode = $("#ddlDepartment").val();
        //    var DesignationCode = "";
        //    LoadRosterEmployee(CompanyCode, DepartmentCode, DesignationCode, rows_selected);
        //});

        $('#ddlDesignation, #ddlCompany, #ddlDepartment, #ddlBranch ').on('change', function () {
            var CompanyCode = $("#ddlCompany").val();
            var Branch = $("#ddlBranch").val();
            var DepartmentCode = $("#ddlDepartment").val();
            var DesignationCode = $("#ddlDesignation").val();
            LoadRosterEmployee(CompanyCode, Branch, DepartmentCode, DesignationCode, rows_selected);
        });

        $('#ddlDesignation2, #ddlCompany2, #ddlDepartment2, #ddlBranch2 ').on('change', function () {
            var CompanyCode2 = $("#ddlCompany2").val();
            var Branch2 = $("#ddlBranch2").val();
            var DepartmentCode2 = $("#ddlDepartment2").val();
            var DesignationCode2 = $("#ddlDesignation2").val();
            LoadGrid(CompanyCode2, Branch2, DepartmentCode2, DesignationCode2);
            
        });

        $('#tblRosterEmployee tbody').on('click', 'input[type="checkbox"]', function (e) {
            var $row = $(this).closest('tr');
            var data = $('#tblRosterEmployee').DataTable().row($row).data();
            var rowId = data["EmployeeID"];
            var ar = {};
            ar["EmployeeID"] = rowId;
            var index = rows_selected.findIndex(x => x.EmployeeID === rowId)
            if (this.checked && index === -1) {
                rows_selected.push(ar);
            } else if (!this.checked && index !== -1) {
                rows_selected.splice(index, 1);
            }
            if (this.checked) {
                $row.addClass('selected');
            } else {
                $row.removeClass('selected');
            }
            console.log(rows_selected);
            updateDataTableSelectAllCtrl();
            e.stopPropagation();
        });

        $('#tblRosterEmployee thead input[name="chkAll"]').on('click', function (e) {
            rows_selected = [];
            if (this.checked) {
                $('#tblRosterEmployee tbody input[type="checkbox"]:not(:checked)').trigger('click');
            } else {
                $('#tblRosterEmployee tbody input[type="checkbox"]:checked').trigger('click');
            }
            console.log(rows_selected);
            e.stopPropagation();
        });

    });

    function updateDataTableSelectAllCtrl() {
        var $table = $('#tblRosterEmployee').DataTable().table().node();
        var $chkbox_all = $('tbody input[type="checkbox"]', $table);
        var $chkbox_checked = $('tbody input[type="checkbox"]:checked', $table);
        var chkbox_select_all = $('thead input[name="chkAll"]', $table).get(0);

        if ($chkbox_checked.length === 0) {
            chkbox_select_all.checked = false;

        } else if ($chkbox_checked.length === $chkbox_all.length) {
            chkbox_select_all.checked = true;
        } else {
            chkbox_select_all.checked = false;
        }
    }

    function LoadRosterEmployee(CompanyCode, Branch,  DepartmentCode, DesignationCode, rows_selected) {

        var table = $('#tblRosterEmployee').DataTable({
                "ajax": {
                "url": '@Url.Action("ShowRosterEmployee", "RosterScheduleEntry")',
                "type": "GET",
                "data": { CompanyCode: CompanyCode, BranchCode: Branch, DepartmentCode: DepartmentCode, DesignationCode: DesignationCode },

                "datatype": "json"
            },
                "columns": [
                { "data": "EmployeeID", defaultContent: '' },
            { "data": "EmployeeID", "autowidth": true },
                { "data": "FirstName", "autowidth": true },
                { "data": "DepartmentName", "autowidth": true }
                //{ "data": "DesignationName", "autowidth": true }
             ],
                'columnDefs': [{
                    'targets': 0,
                    'searchable': false,
                    'orderable': false,
                    'width': '1%',
                    'className': 'dt-body-center',
                    'render': function (data, type, full, meta){
                        return '<input type="checkbox">';
                    }
                }],
            'order': [[1, 'asc']],
            "pageLength": 12,
                'rowCallback': function (row, data, dataIndex) {
                    // Get row ID
                    var rowId = data[0];

                    // If row ID is in the list of selected row IDs
                    if ($.inArray(rowId, rows_selected) !== -1) {
                        $(row).find('input[type="checkbox"]').prop('checked', true);
                        $(row).addClass('selected');
                    }
                },
                "lengthChange": true,
            "pageLength": 10,
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                "bDestroy": true,
            });
    }


    function LoadGrid(Company, Branch, Department, Designation ) {

        @*var dataTable = $('#tblSaveRosterEmployee').DataTable({
            "ajax": {
                "url": '@Url.Action("LoadInfo", "RosterScheduleEntry")',
                "type": "GET",
                "datatype": "json"
            },
            "columns": [

                { "data": "EmployeeID", "autowidth": true },
                { "data": "EmployeeName", "autowidth": true },
                { "data": "Date",  "autowidth": true },
                { "data": "ShiftName", "autowidth": true },
                { "data": "Remark", "autowidth": true }

            ],
            "columnDefs": [
                { "className": "text-center", targets: [2,3] }
            ],
            "lengthChange": true,
            "pageLength": 10,
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
        });*@

        var dataTable;
        dataTable = $('#tblSaveRosterEmployee').DataTable({
            "ajax": {
                "url": '@Url.Action("LoadInfo", "RosterScheduleEntry")',
                "data": { CompanyCode: Company, BranchCode: Branch, DepartmentCode: Department, DesignationCode: Designation },
                "type": "GET",
                "datatype": "json"
            },
            "columns": [
                { "data": "EmployeeID", "autowidth": true },
                { "data": "EmployeeName", "autowidth": true },
                { "data": "Date", "autowidth": true },
                { "data": "ShiftName", "autowidth": true },
                { "data": "Remark", "autowidth": true }
            ],

            "lengthChange": false,
            "pageLength": 10,
            "order": [[1, "Desc"]],

            "bDestroy": true

        });
    }
</script>
